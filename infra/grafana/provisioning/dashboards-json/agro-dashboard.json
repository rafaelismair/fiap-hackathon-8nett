{
  "title": "Agro — MVP",
  "uid": "agro-mvp",
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 1,
  "refresh": "5s",
  "panels": [
    {
      "type": "timeseries",
      "title": "Soil moisture (plot1) — Influx",
      "datasource": { "type": "influxdb", "uid": "InfluxDB" },
      "gridPos": { "x": 0, "y": 0, "w": 24, "h": 10 },
      "targets": [
        {
          "query": "from(bucket: \"readings\")\n  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)\n  |> filter(fn: (r) => r._measurement == \"sensor_readings\")\n  |> filter(fn: (r) => r._field == \"value\")\n  |> filter(fn: (r) => r.plotId == \"plot1\")\n  |> filter(fn: (r) => r.metric == \"soil_moisture\")\n  |> aggregateWindow(every: 1m, fn: mean, createEmpty: false)\n  |> yield(name: \"mean\")"
        }
      ]
    },
    {
      "type": "table",
      "title": "Últimos alertas — Postgres",
      "datasource": { "type": "postgres", "uid": "Postgres" },
      "gridPos": { "x": 0, "y": 10, "w": 24, "h": 10 },
      "targets": [
        {
          "format": "table",
          "rawSql": "SELECT created_at_utc as time, plot_id, severity, rule, message, alert_id\nFROM alerts\nORDER BY created_at_utc DESC\nLIMIT 50;"
        }
      ],
      "options": { "showHeader": true }
    }
  ]
}
